---
// Import your deleted URLs list
import deletedUrls from '../data/json-files/deleted-urls.json';

// Get current path
const { path: pathSegments } = Astro.params;
const currentPath = '/' + (Array.isArray(pathSegments) ? pathSegments.join('/') : pathSegments || '');

// Normalize the path (remove trailing slash)
const normalizedPath = currentPath.replace(/\/+$/, '') || '/';

// Check if this path is deleted
const isDeleted = deletedUrls.includes(normalizedPath);

// Set response status - works in production
if (import.meta.env.PROD) {
  if (isDeleted) {
    Astro.response.status = 410;
  } else {
    Astro.response.status = 404;
  }
}

// For development, we'll handle status differently
let statusCode = isDeleted ? 410 : 404;

// Debug output in dev
if (import.meta.env.DEV) {
  console.log(`[404/410 Handler] Path: ${normalizedPath}, Status: ${statusCode}, Is Deleted: ${isDeleted}`);
  console.log('Deleted URLs:', deletedUrls);
}
---

<html lang="en">
  <head>
    <title>{isDeleted ? '410 Gone' : '404 Not Found'}</title>
    <meta name="robots" content="noindex" />
    <style>
      /* ... your existing styles ... */
    </style>
  </head>
  <body>
    <!-- Development mode indicator -->
    {import.meta.env.DEV && (
      <div class="dev-indicator">
        Development Mode - Status: {statusCode}
      </div>
    )}
    
    <div class="container">
      {isDeleted ? (
        <>
          <h1>410 Gone</h1>
          <p>The resource <code>{normalizedPath}</code> has been permanently removed.</p>
          <p>All links to this resource should be considered obsolete.</p>
          <div class="footer">
            <p>Deleted URLs are managed in <code>src/data/json-files/deleted-urls.json</code></p>
          </div>
        </>
      ) : (
        <>
          <h1>404 Not Found</h1>
          <p>The page <code>{normalizedPath}</code> could not be found.</p>
          <div class="footer">
            <p>If you believe this is an error, please contact support.</p>
          </div>
        </>
      )}
    </div>
    
    <!-- Debug information for development -->
    {import.meta.env.DEV && (
      <script is:inline>
        // Only run in development
        (function() {
          // Update title to reflect status code
          document.title = `${statusCode} ${statusCode === 410 ? 'Gone' : 'Not Found'}`;
          
          // Clean up URL (remove hash/query params)
          const cleanPath = window.location.pathname;
          if (window.location.href !== cleanPath) {
            window.history.replaceState(null, '', cleanPath);
          }
          
          // Log to console for debugging
          console.log(
            `%c[Page Load]%c\nPath: ${normalizedPath}\nStatus: ${statusCode}\nIs Deleted: ${isDeleted}`,
            'background: #4a00e0; color: white; padding: 2px 4px; border-radius: 4px;',
            ''
          );
        })();
      </script>
    )}
  </body>
</html>